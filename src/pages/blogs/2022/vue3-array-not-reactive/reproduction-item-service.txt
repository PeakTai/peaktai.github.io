// 条目列表缓存对象
let _items: string[] | undefined = undefined

type Listener = (items: string[]) => void
const listeners: Array<Listener> = []

export async function getItems(): Promise<string[]> {
  if (_items) {
    return _items
  }
  // 从服务器请求数据
  _items = await doAjax()
  return _items
}

export async function addItem(item: string) {
  const items = await getItems()
  items.push(item)
  listeners.forEach(listener => listener(items))
}

export async function onItemsChange(listener: Listener) {
  listeners.push(listener)
}